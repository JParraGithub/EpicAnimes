{% extends "registration/auth_base.html" %}
{% block title %}Recuperar contraseña | EpicAnimes{% endblock %}
  {# Permite solicitar el enlace de restablecimiento de contraseña.  #}

{% block auth_content %}
  <section class="auth-card glass">
    <div class="auth-card__header">
      <span class="pill"><i class="fa fa-unlock"></i> Recupera tu acceso</span>
      <h1>Restablecer contraseña</h1>
      <p>Ingresa tu correo y te enviaremos un enlace para crear una nueva contraseña.</p>
    </div>

    {% if form.non_field_errors %}
      <div class="message message--warning">
        <i class="fa fa-circle-exclamation"></i>
        <span>
          {% for error in form.non_field_errors %}
            {{ error }}{% if not forloop.last %}<br>{% endif %}
          {% endfor %}
        </span>
      </div>
    {% endif %}

    {% if messages %}
      <div class="auth-messages">
        {% for message in messages %}
          <div class="message message--{{ message.tags|default:'info' }}">
            <i class="fa fa-circle-info"></i>
            <span>{{ message }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="auth-form-panel">
      {% with current_email=form.email.value|default_if_none:'' %}
        <form method="post" class="auth-form" novalidate autocomplete="off">
          {% csrf_token %}
          <div class="form-field">
            <label for="username_hint"><i class="fa fa-user"></i> Nombre de usuario</label>
            <div class="input-icon">
              <i class="fa fa-user"></i>
              <input
                id="username_hint"
                name="username_hint"
                type="text"
                class="form-input"
                placeholder="tuUsuarioEpic"
                autocomplete="username">
            </div>
            <small class="form-helper">Solo referencia: el correo que ingreses debe pertenecer a este usuario.</small>
          </div>
          <div class="form-field">
            <label for="id_email"><i class="fa fa-envelope"></i> Correo electrónico</label>
            <div class="input-icon">
              <i class="fa fa-envelope"></i>
              <input
                id="id_email"
                name="email"
                type="email"
                class="form-input"
                placeholder="tu@correo.com"
                autocomplete="email"
                required
                {% if current_email %}value="{{ current_email }}"{% endif %}>
            </div>
            <small class="form-helper">Usaremos este correo para enviarte el enlace seguro.</small>
            {% if form.email.errors %}
              <div class="text-error">{{ form.email.errors|striptags }}</div>
            {% endif %}
          </div>
          <button type="submit" class="auth-cta">
            <i class="fa fa-paper-plane"></i> Enviar instrucciones
          </button>
        </form>
      {% endwith %}
    </div>

    <div class="auth-links">
      ¿Recordaste tu contraseña? <a href="{% url 'login' %}">Inicia sesión</a>
    </div>
  </section>
{% endblock %}

{% block extra_js %}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const emailInput = document.getElementById('id_email');
      if (emailInput && !emailInput.getAttribute('placeholder')) {
        emailInput.setAttribute('placeholder', 'tu@correo.com');
      }
    });
  </script>
{% endblock %}
